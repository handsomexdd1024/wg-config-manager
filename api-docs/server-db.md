# 服务端业务逻辑-底层接口

## Initialization

config-read_config

> 从配置文件读取并处理配置信息

connection-initialize_connection

> 初始化信息

## Network Request

网络模块的几种不同思路：

- 为每一种消息提供高层api，由网络模块全权处理 json body 的生成
- 让每种请求的发起者（函数）自己构建message json并交给connection部分检验和发送

课上问问老师哪种比较合适



客户端连接请求：connection建立并维护连接列表

- 网络(socket)层面连接和业务逻辑层面连接(包含认证状态等额外信息，需要包装类)

用户认证请求：user模块，网络模块和数据库模块

- 调用db读取用户信息
- 调用user方法进行认证
- 认证回复信息
  - 成功则返回token，在连接包装类里加入对应信息
  - 失败则返回错误信息

用户注册请求：

- 用户名、密码，存储到数据库

加载wireguard配置文件请求：

- 从数据库加载对应的配置文件，然后parse到json文件
- 对请求用户进行鉴权，确定要发送的数据
  - 不属于该用户的node不发送私钥
- 修改后的网络对象parse成json, 然后交给网络模块发送

修改wireguard配置文件请求：

两种思路：记录请求和记录修改后的配置文件

（但diff反正都是要做的，不如交给客户端，然后返回服务端鉴权）

- 发送修改列表和token，服务端鉴权

加入共享配置文件：

- id
- 身份信息
- 管理员收到请求

退出共享配置文件：

- id
- 身份信息

管理员决定是否批准加入请求：

- accept
- deny

用户退出客户端：

- 保存退出时间

共用的reply：收到请求，确认无误
